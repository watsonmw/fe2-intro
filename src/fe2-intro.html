<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Frontier Elite II - Intro</title>
    <style>
      body { background-color: black; margin: 0; }
      canvas.game { border: 0 none; margin-left: auto; margin-right: auto; width: 100%; height: 100%; display: block; }
    </style>
  </head>
  <body>
    <canvas class="game" id="canvas" oncontextmenu="event.preventDefault()" tabindex=-1></canvas>
    <script type='text/javascript'>
      (function() {
        var resizeCanvas = function() {
          var canvas = document.getElementById('canvas');
          var width = document.documentElement.clientWidth;
          var height = document.documentElement.clientHeight;
          var ratioX = 9;
          var ratioY = 5;
          var newWidth = width;
          var newHeight = height;
          if (width * ratioY > height * ratioX) {
            newWidth = (height * ratioX) / ratioY;
          } else if (width * ratioY < height * ratioX) {
            newHeight = (width * ratioY) / ratioX;
            var marginY = (height - newHeight) / 3;
            console.log(marginY);
            canvas.style.marginTop = Math.floor(marginY) + "px";
          }
          canvas.width = newWidth;
          canvas.height = newHeight;
        }
        window.addEventListener('resize', resizeCanvas, false);
        resizeCanvas();
      }());

      var Module = {
        preRun: [],
        postRun: [],
        print: (function() {
          return function(text) {
            if (arguments.length > 1) {
                text = Array.prototype.slice.call(arguments).join(' ');
            }
            console.log(text + "\n");
          };
        })(),
        printErr: function(text) {
          if (arguments.length > 1) {
            text = Array.prototype.slice.call(arguments).join(' ');
          }
          console.error(text);
        },
        canvas: document.getElementById('canvas'),
        setStatus: function(text) {
          if (!Module.setStatus.last) {
            Module.setStatus.last = { time: Date.now(), text: '' };
          }
          if (text === Module.setStatus.last.text) {
            return;
          }
          var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
          var now = Date.now();
          if (m && now - Module.setStatus.last.time < 30) {
            return;
          }
          Module.setStatus.last.time = now;
          Module.setStatus.last.text = text;
          if (m) {
            text = m[1];
            var value = parseInt(m[2])*100;
            var max = parseInt(m[4])*100;
            console.log("Progress ", value, max);
          } else {
            console.log("Progress none");
          }
          console.log("status --- ", text, " ---");
        },
        totalDependencies: 0,
        monitorRunDependencies: function(left) {
          this.totalDependencies = Math.max(this.totalDependencies, left);
          if (left) {
            console.log("dependencies", this.totalDependencies, left);
            if (left === 0) {
              console.log("Done");
            }
          }
        }
      };
      window.onerror = function(event) {
        console.error(event);
      };
      function pauseAudio(on) {
        if (typeof Module === 'undefined' || typeof Module.SDL2 === 'undefined' ||
                typeof Module.SDL2.audio === 'undefined' || typeof Module.SDL2.audioContext === 'undefined') {
          return;
        }
        if (on) {
          Module.SDL2.audio.scriptProcessorNode.disconnect();
        }
        else {
          Module.SDL2.audio.scriptProcessorNode['connect'](Module.SDL2.audioContext['destination']);
        }
      }
      window.addEventListener("blur", function() {
        pauseAudio(1);
      }, false);
      window.addEventListener("focus", function() {
        pauseAudio(0);
      }, false);
    </script>
    <script async type="text/javascript" src="fintro.js"></script>
  </body>
</html>
