<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <title>Frontier Elite II - Intro</title>
    <style>
      body { background-color: black; margin: 0; }
      canvas.emscripten { position: fixed; border: 0 none; display: block; }
      button {
        float: right;
        display: block;
        box-sizing: border-box;
        margin: 6px;
        padding: 3px 3px 0 3px;
        border: 0;
        background: none;
      }
      button:hover {
        padding: 2px 2px 0 2px;
        border: 1px solid black;
        outline: 1px solid white;
      }
      div.overlay { position: fixed; z-index: 1; width: 100%; opacity: 0.0; transition: .4s ease; }
      div.loading-overlay { position: fixed; z-index: 1; width: 100%; height: 100%; }
    </style>
  </head>
  <body>
    <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" tabindex=-1></canvas>
    <div class="overlay" id="overlay-controls">
      <button id="exitFullscreenButton">
        <svg width=32 height=32>
          <polygon fill="white" stroke="black" points="23.33 20.5 28.5 20.5 28.5 16.5 16.5 16.5 16.5 28.5 20.5 28.5 20.5 23.33 28.17 31 31 31 31 28.17 23.33 20.5"></polygon>
          <polygon fill="white" stroke="black" points="11.5 8.67 3.83 1 1 1 1 3.83 8.67 11.5 3 11.5 3 15.5 15.5 15.5 15.5 3 11.5 3 11.5 8.67"></polygon>
        </svg>
      </button>
      <button id="fullscreen-button">
        <svg width=32 height=32>
          <polygon fill="white" stroke="black" points="27 18 27 24.17 19.41 16.59 16.59 19.41 24.17 27 18 27 18 31 31 31 31 18 27 18"></polygon>
          <polygon fill="white" stroke="black" points="14 5 14 1 1 1 1 14 5 14 5 7.83 12.34 15.16 15.16 12.34 7.83 5 14 5"></polygon>
        </svg>
      </button>
    </div>
    <div class="loading-overlay" id="loading-overlay">
      <div style="position: absolute; bottom: 0;"><p id="status" style="color:white;font-family: Geneva,monospace"></p></div>
    </div>
    <script type='text/javascript'>
      var Module = {
        preRun: [],
        postRun: [],
        print: (function() {
          return function(text) {
            if (arguments.length > 1) {
              text = Array.prototype.slice.call(arguments).join(' ');
            }
            console.log(Date.now(), text);
          };
        })(),
        printErr: function(text) {
          if (arguments.length > 1) {
            text = Array.prototype.slice.call(arguments).join(' ');
          }
          console.error(text);
        },
        canvas: document.getElementById('canvas'),
        setStatus: function(text) {
          if (!Module.setStatus.last) {
            Module.setStatus.last = { time: Date.now(), text: '' };
          }
          if (text === Module.setStatus.last.text) {
            return;
          }
          var now = Date.now();
          console.log(now, text);
          var statusEl = document.getElementById("status");
          statusEl.innerText = text;
        },
        onRuntimeInitialized: function() {
          var overlay = document.getElementById("loading-overlay");
          overlay.style.display = 'none';
        }
      };
      var resizeCanvas = (function() {
        var resizeCanvasFunc = function() {
          // Control the canvas location directly
          var canvas = document.getElementById('canvas');
          var width = document.documentElement.clientWidth;
          var height = document.documentElement.clientHeight;
          var ratioX = 9;
          var ratioY = 5;
          var newWidth = width;
          var newHeight = height;
          var marginX = 0;
          var marginY = 0;
          if (width * ratioY > height * ratioX) {
            newWidth = (height * ratioX) / ratioY;
            marginX = (width - newWidth) / 2;
          } else if (width * ratioY < height * ratioX) {
            newHeight = (width * ratioY) / ratioX;
            marginY = (height - newHeight) / 3;
          }
          canvas.style.left = Math.floor(marginX) + "px";
          canvas.style.top = Math.floor(marginY) + "px";
          canvas.style.width = Math.floor(newWidth) + "px";
          canvas.style.height = Math.floor(newHeight) + "px";
        }
        window.addEventListener('resize', resizeCanvasFunc, false);
        // Initial layout
        resizeCanvasFunc();
        // Final layout, if running in fullscreen mode as a fullscreen app on Chrome the view area is a bit small
        // the first time the screen is rendered.
        setTimeout(resizeCanvasFunc, 0);
        return resizeCanvasFunc;
      }());
      var OverlayControls = (function(){
        var docEl = window.document.documentElement;
        var doc = window.document;
        var getRequestFullScreenFunc = function() {
          return docEl.requestFullscreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
        };
        var getCancelFullScreenFunc = function() {
          return doc.exitFullscreen || doc.webkitExitFullscreen || doc.msExitFullscreen;
        };
        var isFullScreen = function() {
          return doc.fullscreenElement || doc.webkitFullscreenElement || doc.msFullscreenElement;
        };
        function show(e) {
          if (e.style.display === "none") {
            e.style.display = "block";
          }
        }
        function hide(e) {
          if (e.style.display !== "none") {
            e.style.display = "none";
          }
        }
        var overlay = document.getElementById("overlay-controls");
        var fullscreenButton = document.getElementById("fullscreen-button");
        var exitFullscreenButton = document.getElementById("exitFullscreenButton");
        document.addEventListener("fullscreenchange", function () {
          if (isFullScreen()) {
            hide(fullscreenButton);
            show(exitFullscreenButton);
          } else {
            hide(exitFullscreenButton);
            show(fullscreenButton);
          }
          window.setTimeout(function () {
          resizeCanvas()}, 0);
        }, false);
        var setup = function () {
          // If running as fullscreen app already, skip overlay setup
          if (overlay.style.display === 'none') {
            return;
          }
          if (document.fullscreenEnabled || document.webkitFullscreenEnabled || document.msFullscreenEnabled) {
            hide(exitFullscreenButton);
            show(fullscreenButton);
            var isHover = function(e) {
              return!!(e.querySelector(":hover") || e.parentNode.querySelector(":hover") === e);
            };
            var hideTimer = null;
            var showControls = function(checkHover) {
              overlay.style.opacity = "0.9";
              if (hideTimer) {
                window.clearTimeout(hideTimer);
              }
              if (!checkHover || !isHover(overlay)) {
                hideTimer = window.setTimeout(function() {
                  overlay.style.opacity = "0.0";
                  hideTimer = null;
                }, 3000);
              }
            };
            window.addEventListener("mousemove", function () { showControls(true) });
            window.addEventListener("mousedown", function () { showControls(true) });
            window.addEventListener("touchend", function () { showControls(false) });
            showControls(false);
            var toggleFullScreen = function () {
              if (isFullScreen()) {
                getCancelFullScreenFunc().call(window.document);
              } else {
                getRequestFullScreenFunc().call(window.document.documentElement);
              }
              showControls(false);
            };
            fullscreenButton.addEventListener("click", toggleFullScreen, false);
            exitFullscreenButton.addEventListener("click", toggleFullScreen, false);
          } else {
            hide(exitFullscreenButton);
            hide(fullscreenButton);
          }
        };
        return {
          setup: setup
        }
      })();
      OverlayControls.setup();
      // Make sure the audio is paused whenever the screen is hidden / deactivated.
      function pauseAudio(on) {
        if (typeof Module === 'undefined' || typeof Module.SDL2 === 'undefined' ||
                typeof Module.SDL2.audio === 'undefined' || typeof Module.SDL2.audioContext === 'undefined') {
          return;
        }
        if (on) {
          Module.SDL2.audio.scriptProcessorNode.disconnect();
        } else {
          Module.SDL2.audio.scriptProcessorNode['connect'](Module.SDL2.audioContext['destination']);
        }
      }
      window.addEventListener("blur", function() {
        pauseAudio(1);
      }, false);
      window.addEventListener("focus", function() {
        pauseAudio(0);
      }, false);
    </script>
    <script async type="text/javascript" src="fintro.js"></script>
  </body>
</html>
